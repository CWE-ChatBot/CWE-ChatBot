# CWE ChatBot Environment Configuration
# Copy this file to .env and fill in your actual values

# ============================================================================
# DATABASE CONFIGURATION (PostgreSQL with pgvector)
# ============================================================================

# Database Connection (required)
DB_HOST=localhost                    # Cloud SQL Private IP: 10.43.0.3 (production)
DB_PORT=5432
DB_NAME=postgres                     # Database containing cwe_chunks table
DB_USER=postgres                     # Production: app_user
DB_PASSWORD=your_password_here       # Get from: gcloud secrets versions access latest --secret=db-password-app-user

# Database SSL/TLS
DB_SSLMODE=require                   # Options: disable, allow, prefer, require, verify-ca, verify-full

# Connection Pooling (optional - defaults shown)
DB_POOL_SIZE=4                       # Number of connections to maintain
DB_MAX_OVERFLOW=0                    # Maximum overflow connections beyond pool_size
DB_POOL_RECYCLE_SEC=1800            # Recycle connections after 30 minutes
DB_POOL_USE_LIFO=true               # Use LIFO (stack) for connection retrieval
DB_WARM_POOL=true                   # Pre-warm connection pool on startup

# ============================================================================
# AI/LLM CONFIGURATION
# ============================================================================

# Google Gemini API (required for embeddings and chat)
GEMINI_API_KEY=your_gemini_api_key   # Get from: https://makersuite.google.com/app/apikey
                                     # Production: gcloud secrets versions access latest --secret=gemini-api-key

# Vertex AI (optional - for enterprise deployments)
GOOGLE_CLOUD_PROJECT=cwechatbot      # Your GCP project ID
VERTEX_AI_LOCATION=us-central1       # Vertex AI region

# LLM Provider Selection
PROVIDER=google                      # Options: google (Gemini), vertex (Vertex AI)

# Embedding Configuration
EMBEDDING_MODEL=models/embedding-001 # Gemini embedding model
EMBEDDING_DIMENSIONS=3072            # Embedding vector dimensions

# Response Generation
DISABLE_AI=0                         # Set to 1 to disable AI (testing only)
GEMINI_OFFLINE=0                     # Set to 1 for offline mode (testing only)
E2E_NO_STREAM=0                      # Set to 1 to disable streaming (E2E tests)

# ============================================================================
# RETRIEVAL CONFIGURATION (RAG)
# ============================================================================

# Reciprocal Rank Fusion Weights
RRF_W_VEC=0.65                       # Weight for vector similarity (0-1)
RRF_W_FTS=0.25                       # Weight for full-text search (0-1)
RRF_W_ALIAS=0.10                     # Weight for alias matching (0-1)

# CWE Ingestion Path (optional)
CWE_INGESTION_PATH=                  # Path to CWE ingestion module (auto-detected if empty)

# Database Stats (optional)
SKIP_DB_STATS=false                  # Set to true to skip DB stats queries on startup

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Security Mode
SECURITY_MODE=FLAG_ONLY              # Options: FLAG_ONLY, BLOCK, OFF

# Input Validation
MAX_INPUT_LENGTH=1000                # Maximum user input length
ENABLE_STRICT_SANITIZATION=true      # Enable strict input sanitization

# Session Security
SESSION_TIMEOUT=3600                 # Session timeout in seconds (1 hour)

# Chainlit Authentication
CHAINLIT_AUTH_SECRET=your_secret     # Random secret for OAuth state
                                     # Production: gcloud secrets versions access latest --secret=chainlit-auth-secret

# OAuth Providers (optional - for authentication)
OAUTH_GOOGLE_CLIENT_ID=              # Google OAuth client ID
OAUTH_GOOGLE_CLIENT_SECRET=          # Google OAuth client secret
OAUTH_GITHUB_CLIENT_ID=              # GitHub OAuth client ID
OAUTH_GITHUB_CLIENT_SECRET=          # GitHub OAuth client secret
# Get from Secret Manager:
# gcloud secrets versions access latest --secret=oauth-google-client-id
# gcloud secrets versions access latest --secret=oauth-google-client-secret
# gcloud secrets versions access latest --secret=oauth-github-client-id
# gcloud secrets versions access latest --secret=oauth-github-client-secret

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================

# PDF Worker Service (Cloud Function)
PDF_WORKER_URL=https://pdf-worker-bmgj6wj65a-uc.a.run.app

# ============================================================================
# DEVELOPMENT/TESTING
# ============================================================================

# Test Configuration
LLM_FALLBACK_MARKER_PATH=test-results/llm_fallback_marker

# Cloud Run Configuration (deployment only)
# These are typically set via gcloud run deploy, not .env
# MIN_INSTANCES=1
# MAX_INSTANCES=10
# CONCURRENCY=40
# MEMORY=512Mi
# CPU=1

# ============================================================================
# HOW TO GET VALUES
# ============================================================================

# Database Password:
#   gcloud secrets versions access latest --secret=db-password-app-user --project=cwechatbot

# Gemini API Key:
#   1. Visit https://makersuite.google.com/app/apikey
#   2. Or: gcloud secrets versions access latest --secret=gemini-api-key --project=cwechatbot

# OAuth Credentials:
#   gcloud secrets versions access latest --secret=oauth-google-client-id --project=cwechatbot
#   gcloud secrets versions access latest --secret=oauth-google-client-secret --project=cwechatbot
#   gcloud secrets versions access latest --secret=oauth-github-client-id --project=cwechatbot
#   gcloud secrets versions access latest --secret=oauth-github-client-secret --project=cwechatbot

# Chainlit Auth Secret:
#   gcloud secrets versions access latest --secret=chainlit-auth-secret --project=cwechatbot

# Cloud SQL Private IP (production):
#   gcloud sql instances describe cwe-chatbot-db --project=cwechatbot --format='value(ipAddresses[0].ipAddress)'
